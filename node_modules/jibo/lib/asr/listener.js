"use strict";var e=function(){function e(e,t){for(var i in t){var r=t[i];r.configurable=!0,r.value&&(r.writable=!0)}Object.defineProperties(e,t)}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),t=function o(e,t,i){var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var s=Object.getPrototypeOf(e);return null===s?void 0:o(s,t,i)}if("value"in r&&r.writable)return r.value;var n=r.get;if(void 0!==n)return n.call(i)},i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(e.__proto__=t)},r=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=require("events").EventEmitter,n=function(s){function n(e,i){r(this,n),t(Object.getPrototypeOf(n.prototype),"constructor",this).call(this),this.options=e,this.rule=i,this.status="INVALID"}return i(n,s),e(n,{onFinished:{value:function(){this.emit("finished"),this.status="SUCCEEDED",this.removeAllListeners(),this.action.stop(),this.action.clear()}},heyJiboResult:{value:function(){this.heyJiboPhrase&&this.tdSpeakerResult&&this.emit("embedded",this.heyJiboPhrase,this.tdSpeakerResult)}},cloudResult:{value:function(){this.asrResult&&this.tiSpeakerResult&&this.emit("cloud",this.asrResult,this.tiSpeakerResult)}},addCloudRecognizer:{value:function(e){var t=this,i=new this.asr.CloudRecognizer(this.rule,e);return i.on("result",function(e){t.asrResult=e,t.cloudResult(),i.removeAllListeners("result")}),i.on("error",function(e){t.emit("error",e)}),e.incremental&&i.on("incremental",function(e){t.emit("incremental",e)}),""+i.pack()}},addHeyJibo:{value:function(){var e=this,t="",i=new this.asr.Recognizer({path:"hey_jibo"});return i.on("result",function(t){e.heyJiboPhrase=t,e.heyJiboResult(),i.removeAllListeners("result")}),t=this.tdReco?"("+i.pack()+" * "+this.tdReco.pack()+")":""+i.pack(),"("+t+")"}},addSpeakerRecognizers:{value:function(){var e=this;return this.tiReco=new this.asr.SpeakerRecognizer({authTI:!0}),this.tiReco.on("result",function(t){e.tiSpeakerResult=t,e.cloudResult(),e.tiReco.removeAllListeners("result")}),"("+this.tiReco.pack()+")"}},addEOSRecognizer:{value:function(){var e=this,t=new this.asr.EndOfSpeechRecognizer({});return t.on("result",function(){e.emit("end"),t.removeAllListeners("result")}),""+t.pack()}},start:{value:function(){var e=this;if(this.asr=require("../main").asr,"IN_PROGRESS"===this.status)return this.emit("error","cannot restart; listener is currently in progress."),!1;this.status="IN_PROGRESS",this.tiSpeakerResult=!1,this.tdSpeakerResult=!1,this.action=this.asr.createAudioAction(),this.action.on("finished",function(){e.onFinished()}),this.action.on("speakerid",function(t){var i=t.speaker_ids,r=t.speaker_idstatus;e.tdSpeakerResult={speakerIds:i,speakerIdStatus:r},e.heyJiboResult()}),this.action.on("error",function(t){e.emit("error",t)});var t=void 0;if(this.options.embeddedOnly)t=this.addHeyJibo();else{t=this.addCloudRecognizer(this.options,this.rule);var i=this.addSpeakerRecognizers(t);if(t="("+i+" * "+t+")",this.options.detectEnd){var r=this.addEOSRecognizer();t="("+r+" | "+t+")"}if(this.options.heyJibo){var s=this.addHeyJibo();t="("+s+" * "+t+")"}}return this.action.start(t),!0}},stop:{value:function(){this.onFinished()}}}),n}(s);module.exports=n;