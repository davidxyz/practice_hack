"use strict";function n(n){if(p.existsSync(n)){var t=require(n);if(t.jibo&&"asset-pack"===t.jibo.type){var i=f.resolve(f.parse(n).dir,t.main);return require(i)}}}function t(n){var t=void 0,i=void 0;d.series([function(n){g.on("set-registry-host",function(i){"string"==typeof i||i instanceof String?t=i:(t=i.registryHost,i.token&&(A.token=i.token,console.warn("Session Token = "+A.token))),n()})},function(n){var e=new XMLHttpRequest;e.timeout=2e3,e.onreadystatechange=function(){4===e.readyState&&200===e.status?(i=JSON.parse(e.responseText),i.records&&(i=i.records,i.sort(function(n,t){return"system-manager"===n.name?-1:"system-manager"===t.name?1:-1})),n()):4===e.readyState&&0===e.status&&n("Could not find registry service at "+t)},e.open("GET",t,!0),e.send(null)},function(){var t=[];i.forEach(function(n){var i=k[n.name];"system-manager"===n.name&&(i=k.systemManager),i&&t.push(function(t){i(n,t)})}),d.parallel(t,function(t,i){t?(console.error("Error: "+t),n(t)):n(null,i)})}],function(t,i){t?(console.error("Error: "+t),n(t)):n(null,i)}),g.send("get-registry-host")}function i(n){m(O.animate,n)}function e(n){if(GLOBAL.isInitializing||GLOBAL.isInitialized)throw new Error("Jibo Singleton may only be initialized once.");GLOBAL.isInitializing=!0,d.series({initAnimate:i,initNetwork:t},function(t){if(t){var i='<div style="position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:999999;background:#a7a7a7;text-align:center;">';i+='<span style="position:absolute;top:250px;left:0px;font-size:44px;font-weight:bold;font-family:Arial;color:#c50000;padding:20px;">'+t+"</span>",i+="</div>",document.body.innerHTML+=i,n(t)}else y.addAllBehaviors(),GLOBAL.isInitialized=!0,n()})}function r(n){return"function"!=typeof n?new Promise(function(n,t){e(function(i){i?t(i):n()})}):void e(n)}var o=function(n){return n&&n.__esModule?n["default"]:n},s=require("animation-utilities"),a=s.body,u=s.LEDOutput,c=s.animate,l=s.visualize,f=o(require("path")),p=o(require("fs")),d=o(require("async")),g=o(require("ipc")),m=o(require("./api/animate")),y=o(require("./bt/main")),v=o(require("./lps-service")),L=o(require("./tts-service")),b=o(require("./nli-service")),q=o(require("./asr/asr-service")),h=o(require("./non-motion-bs")),S=o(require("./system-manager")),A=o(require("./session-manager")),O={init:r,requireAssetPack:n,animate:c.createAnimationUtilities(),visualize:l,asr:q,bt:y,nlu:b,systemManager:S,lps:v,tts:L,bodySettings:h};GLOBAL.jibo||(GLOBAL.jibo=O,GLOBAL.isInitialized=!1,GLOBAL.isInitializing=!1);var k={tts:function(n,t){L.init(n,t)},lps:function(n,t){v.init(n,t)},body:function(n){var t=function(t,i){return n.apply(this,arguments)};return t.toString=function(){return n.toString()},t}(function(n,t){var i="ws:"+n.host+":"+n.port,e=new a.BodyPosVelOutput(l.timeline.getClock(),l.robotInfo,i,!0,33);l.timeline.addOutput(e,null);var r=new u(l.timeline.getClock(),l.robotInfo,i,!0,33);l.timeline.addOutput(r,null),h.init(n,t)}),nlu:function(n){var t=function(t,i){return n.apply(this,arguments)};return t.toString=function(){return n.toString()},t}(function(n,t){b.init(n,t)}),asr:function(n){var t=function(t,i){return n.apply(this,arguments)};return t.toString=function(){return n.toString()},t}(function(n,t){q.init(n,t)}),systemManager:function(n){var t=function(t,i){return n.apply(this,arguments)};return t.toString=function(){return n.toString()},t}(function(n,t){S.init(n,t)})};module.exports=GLOBAL.jibo;