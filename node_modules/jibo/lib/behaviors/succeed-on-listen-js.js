"use strict";var t=require("../bt/main"),e=t.Status,i=t.createDecorator,n=t.factory,s=require("../main").asr,r=require("events").EventEmitter;module.exports=i({constructor:function(t,i,n){this.getOptions=t,this.getRule=i,this.onResult=n,this.status=e.INVALID},start:function(){var t=this,i=this.getOptions();return this.status=e.IN_PROGRESS,s.isInitialized?(this.emitter=new r,this.getRule(function(n){t.listener=s.createListener(i,n),t.listener.start(),t.listener.on("cloud",function(e,i){t.emitter.emit("cloud",e,i)}),t.listener.on("incremental",function(e){t.emitter.emit("incremental",e,function(){t.listener.stop()})}),t.listener.on("embedded",function(e,i){t.emitter.emit("hey-jibo",e,i)}),t.listener.on("end",function(){t.emitter.emit("end")}),t.listener.on("error",function(e){t.emitter.emit("error",e)}),t.listener.on("finished",function(){t.listener.removeAllListeners(),t.status=e.SUCCEEDED}),t.onResult(t.emitter),t.status=e.IN_PROGRESS}),!0):(console.warn("Running listen without ASR service"),!0)},stop:function(){this.emitter&&(this.emitter.removeAllListeners(),this.emitter=void 0),this.listener&&(this.listener.removeAllListeners(),this.listener.action.stop(),this.listener.action.clear(),this.listener=void 0)},update:function(t){return this.status===e.IN_PROGRESS?t:this.status}}),n.addBehavior(module);